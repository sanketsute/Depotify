<%= turbo_frame_tag "cart_modal_content" do %>
  <div class="flex h-full flex-col bg-gray-900 shadow-xl">
    
    <div class="flex items-start justify-between px-4 py-6 sm:px-6 border-b border-gray-700">
      <h2 class="text-lg font-medium text-white" id="slide-over-title">Your Cart</h2>
      <div class="ml-3 flex h-7 items-center">
        <button type="button" data-action="click->slideover#close" class="relative -m-2 p-2 text-gray-400 hover:text-gray-200">
          X
        </button>
      </div>
    </div>

    <div class="flex-1 overflow-y-auto py-6 px-4 sm:px-6">
      <% if (@cart.present? && @cart.line_items.any?) %>
        <ul role="list" class="-my-6 divide-y divide-gray-700">
          <% @cart.line_items.each do |line_item| %>
            <li class="flex py-6">
              <div class="h-20 w-20 shrink-0 overflow-hidden rounded-md border border-gray-700 bg-white p-1">
                 <%= image_tag line_item.product.image_url, class: "h-full w-full object-contain object-center" %>
                 <div class="h-full w-full bg-gray-100"></div>
              </div>

              <div class="ml-4 flex flex-1 flex-col">
                <div>
                  <div class="flex justify-between text-base font-medium text-white">
                    <h3><%= line_item.product.title %></h3>
                    <p class="ml-4"><%= number_to_currency(line_item.product.price * line_item.quantity) %></p>
                  </div>
                </div>
                <div class="flex flex-1 items-end justify-between text-sm">
                  <div class="flex items-center border border-gray-700 rounded overflow-hidden mt-2">
                     <%= button_to '-', line_item_path(line_item), method: :patch, params: { line_item: { quantity: line_item.quantity - 1 }, turbo_stream: "true" }, class: "px-3 py-1 text-gray-400 hover:bg-gray-800 hover:text-white cursor-pointer disabled:cursor-not-allowed", disabled: line_item.quantity <= 1 %>
                     <input type="text" value="<%= line_item.quantity %>" class="w-10 text-center py-1 bg-gray-900 text-white focus:outline-none border-x border-gray-700 text-sm" readonly>
                     <%= button_to '+', line_item_path(line_item), method: :patch, params: { line_item: { quantity: line_item.quantity + 1 }, turbo_stream: "true" }, class: "px-3 py-1 text-gray-400 hover:bg-gray-800 hover:text-white cursor-pointer" %>
                  </div>

                  <div class="flex">
                     <%= button_to 'Remove', line_item_path(line_item), method: :delete, params: { turbo_stream: "true" }, class: "font-medium text-indigo-400 hover:text-indigo-300 bg-transparent border-0 p-0" %>
                  </div>
                </div>
              </div>
            </li>
          <% end %>
        </ul>
      <% else %>
        <p class="text-gray-400 text-center mt-10">Your cart is currently empty.</p>
      <% end %>
    </div>

    <div class="border-t border-gray-700 px-4 py-6 sm:px-6 bg-gray-900">
      <div class="flex justify-between text-base font-medium text-white">
        <p>Subtotal</p>
        <p><%= @cart ? number_to_currency(@cart.total_price) : "0.00" %></p>
      </div>
      <p class="mt-0.5 text-sm text-gray-400">Shipping and taxes calculated at checkout.</p>
      <% if @cart.present? %>
        <div class="mt-6">
          <%= link_to 'Show Cart', cart_path(@cart), data: { turbo_frame: "_top" }, class: "flex items-center justify-center rounded-md border border-transparent bg-white px-6 py-3 text-base font-medium text-gray-900 shadow-sm hover:bg-gray-100" %>
        </div>
      <% end %>
      <div class="mt-6 flex justify-center text-center text-sm text-gray-400">
        <p>
          or
          <button type="button" data-action="click->slideover#close" class="font-medium text-indigo-400 hover:text-indigo-300">
            Continue Shopping
            <span aria-hidden="true"> &rarr;</span>
          </button>
        </p>
      </div>
    </div>
  </div>
<% end %>